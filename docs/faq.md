常见问答
=====================


-----------

我们需要分清烧录工具、配置工具、DFU升级这几个概念：

1. 配置工具，可用于修改键盘的设置和配列
    - 老硬件和新硬件都可使用配置工具，但老硬件需要先更新固件到较新版本
    - 配置工具可以直接读取键盘数据，可以直接写入配列而不用升级固件，可以存储您的配置

2. 烧录工具，可通过USB线连接键盘，刷入`USB固件`和`蓝牙固件`。
    - 烧录工具可以更新`USB固件`和`蓝牙固件`，但老版本硬件并不支持通过烧录工具更新`蓝牙固件`

3. DFU升级，是使用手机APP，通过蓝牙连接更新`蓝牙DFU升级包`。
    - 如果您是老版PCB，是不支持烧录工具更新蓝牙固件的，只能采用DFU升级蓝牙固件
    - DFU升级 实际只升级了蓝牙核心固件，不会更新Bootloader与蓝牙通讯协议栈，也不会删除存储的数据

如何控制或关闭RGB轴灯
-----------------------
1. 轴灯版PCB：
    - 轴灯版PCB的轴灯分为轴灯模式和指示灯模式，出厂默认为指示灯模式，可通过<kbd>Lshift</kbd>+<kbd>Rshift</kbd>+<kbd>L</kbd> 在指示灯模式和轴灯模式之间切换。
    - 指示灯模式时，不可控制，固件显示不同颜色指示不同状态
    - 要控制轴灯，请通过<kbd>Lshift</kbd>+<kbd>Rshift</kbd>+<kbd>L</kbd> 先切换到轴灯模式。
    - 切换到轴灯模式后，通过<kbd>Lshift</kbd>+<kbd>Rshift</kbd>+<kbd>X</kbd>可开关轴灯。
    - 通过<kbd>Lshift</kbd>+<kbd>Rshift</kbd>+<kbd>Z</kbd> <kbd>A</kbd> <kbd>S</kbd> <kbd>C</kbd> <kbd>V</kbd>等RGB控制功能调整轴灯。
    
2. RGB轴灯版PCB：
    - RGB轴灯版PCB的通过<kbd>Lshift</kbd>+<kbd>Rshift</kbd>+<kbd>X</kbd>可开关轴灯。
    - 通过<kbd>Lshift</kbd>+<kbd>Rshift</kbd>+<kbd>Z</kbd> <kbd>A</kbd> <kbd>S</kbd> <kbd>C</kbd> <kbd>V</kbd>等RGB控制功能调整轴灯。
    - 接入配置工具，找到 灯光 功能，将RGB阵列相关按键设定到你指定的按键上控制RGB灯光


<span id="如何改善蓝牙连接稳定性">如何改善蓝牙连接稳定性</span>
-------------------------

蓝牙的信号可能受到多方面因素的影响，如蓝牙适配器的兼容性、如其他2.4G的通讯干扰。
在无线干扰很强的地方，会严重影响您在蓝牙模式使用键盘的体验。这并不是GT系列产品的问题，而是所有蓝牙键鼠产品都需要面临的问题。

如蓝牙信号受干扰，出现断链，输出延迟等问题。您可以尝试以下方法来改善蓝牙信号：

1. 使用非金属外壳、非金属定位板与非金属桌面
2. 确保键盘和蓝牙适配器之间无遮挡 或 减少遮挡
    -  如将蓝牙适配器或主机从桌面下移动到桌面上
    -  如移除蓝牙键盘和蓝牙适配器之间的遮挡物
3. 将键盘和蓝牙适配器尽可能的靠近（一般3米距离内能确保信号稳定）
4. 使用USB的蓝牙适配器时，需正确使用
    - 避免USB3.0对蓝牙适配器的影响，如蓝牙适配器插入USB2.0接口而不是USB3.0接口
    - 同时USB蓝牙适配器应当远离USB3.0的设备，如USB3.0的U盘
    - 如果插入USB HUB，请选购质量较好的HUB
5. 使用的WiFi和蓝牙二合一网卡时，确保主机信号良好
    -  使用5GHZ的WiFi，否则请降低2.4GHZ的WiFi的发射功率，避免WiFi和蓝牙相互干扰
    -  台式机的话请接上外置天线，确保主机信号良好
6. 解决蓝牙兼容性问题，兼容性问题会导致信号较强时，键盘也会频繁断开连上等问题
    -  已知部分采用国产芯片的蓝牙适配器，与低功耗蓝牙兼容性较差，可更换蓝牙适配器
    -  选购蓝牙适配器，推荐Intel、CSR、博通等大厂芯片
    -  如果驱动较老，请将驱动更新到较新版本 或 稳定版本
    -  如有必要可以调节驱动的部分选项，如在驱动的电源管理选项卡中关闭“允许计算机关闭此设备以节约电源”选项
    -  确保操作系统对蓝牙4.0支持较好，例如Win7对蓝牙4.0支持就很差
7. 和无线路由器保持一定距离，改善信号干扰
8. 减少空间内其他WiFi和蓝牙设备的存在
9. 不要触摸或遮挡蓝牙模块的天线位置

我们不建议采用金属外壳，虽然我们也提供了铝合金外壳，而且从实测来看，信号良好的情况下，基本都能正常使用，但信号或多或少都受影响。

<span id="如何进入DFU模式">如何进入DFU模式</span>
-----
!!! tip "我们在逐步淘汰DFU升级模式，新PCB建议采用USB线刷"

要想进行固件DFU升级，必须正确的进入DFU升级模式，下面讲述3种进入方法：

1. 键盘系统按键进入：开机状态，按下<kbd>Lshift</kbd>+<kbd>Rshift</kbd>+<kbd>B</kbd>可进入DFU模式。如果因为自己的配列没有设定shift按键导致无法以键盘按键进入，可使用后面的方法。
2. 长按背部多功能按钮进入：开机状态，长按PCB背面的背部多功能按钮4秒以上后松手，可以进入DFU模式。
3. 断电强行进入：如果因为键盘系统崩溃了，上述两种方法都不可行,可以采用断电强行进入方式。
    - 老bootloader：通常是老版本PCB。将键盘电池及USB线去掉，按住 PCB背部多功能按钮 的同时，按住第一排按键的第一个或者最后一个按键（如：BLE60、Omega64是第一个，Omega45、Omega50和Farad69是最后一个），然后插入USB线或者插入电池通电，即可强行进入DFU模式。
    - 新bootloader：轴灯PCB或升级SDK17固件后，将键盘电池及USB线去掉，按住 PCB背部多功能按钮 的同时，插入USB线或者插入电池通电，通电4秒后松开 PCB背部多功能按钮 即可强行进入DFU模式。

!!! tip "正确进入DFU模式后，指示灯会常亮。"

如何退出 DFU 模式
--------------------
在 DFU 模式下无操作 1 分半钟后即可自动退出 DFU 模式。

<span id="如何进入USB刷写模式">如何进入USB刷写模式</span>
---------------------
将键盘与电脑连接的 USB 线断开（不要接入USB，不需要取下电池）。
找到PCB上 标识为K1的两个通孔焊盘，然后用镊子之类的金属物体短接这两个焊盘。
保持短接K1位置的通孔焊盘的同时，插入USB，插入USB后可放开K1的短接。
此时USB芯片应当已经进入USB ISP刷写模式。

!!! tip "用烧录工具烧录USB固件时，烧录工具会自动跳转USB刷写模式，无需手动短接K1。"

如何外接灯带
-----

购买什么灯带：淘宝搜索ws2812灯带购买，建议购买1米30灯的规格，1米60灯的话灯带太亮灯珠太密集。

灯带怎么接：WS2812灯带DI 接 电路板上RGB； 灯带GND 接 电路板GND ； 灯带5V 接 电路板VCC。

如果键盘本身已经焊接了底灯，需要将第一颗WS2812底灯拆除，灯带才能正常工作。

注：默认仅支持8颗底灯，如需支持更多底灯需自行编译固件

如何选购电池
------
普通的3.7v的锂电池就行；

容量建议1000mah即可，不开灯情况下约可续3个月，不建议容量太大的电池；

电池的体积大小就要根据你的壳子的内部空间自己确定了；

现在店铺PCB均采用ZH1.5接口，电池请购买ZH1.5正向插。

<span id="如何检测键盘">如何检测键盘</span>
----------------------------------
键盘PCB购买后，请及时按照下列步骤完成检测：

1. 下载运行 [按键检测软件](http://glab.online/down/keyboardtestutility.exe)  或 访问[按键检测网站](https://glab.online/keytest/) 。

2. 将键盘PCB用USB线连接到电脑 或 通电状态通过蓝牙连接到设备

2. 使用镊子或短导线短接键盘PCB背面热拔插轴座的两个金属脚。

3. 查看每一个脚是否都能正确的触发按键（检测网站或软件是否有按键变色）。

4. 如果都能触发，并且没有串键，证明键盘PCB完好。

!!! tip "不是每一个按键都能被检测"
    如FN按键是无法被检测到的，必须和其他按键配合完成检测。<br>所以检测的时候有某一个按键无法检测，也许它是一颗FN按键。<br>检测的时候有某一个按键感觉不太灵敏，也许它是一颗二合一按键。<br>你可以连接配置工具查看默认按键，并更改后再测试。
    

<span id="如何重置键盘">如何重置键盘</span>
------------------------

1. 或 长按PCB背面按钮10秒以上后松手。（此方式清空后，蓝牙绑定信息也会一并清空）。

2. 或 通过配置工具连接后，选择`重置键盘`进行重置。（此方式清空不会清楚蓝牙绑定信息）

<span id="如何查看蓝牙固件版本">如何查看键盘默认按键</span>
----------------------
参考[配置键盘](configurator.md),将键盘接入[Lotlab 键盘配置工具](http://keyboard.lotlab.org) 

正确接入后，载入默认配列，可查看默认按键设置

或 通过检测软件进行检测

<span id="如何查看蓝牙固件版本">如何查看蓝牙固件版本</span>
------------------
参考[配置键盘](configurator.md),将键盘接入[Lotlab 键盘配置工具](http://keyboard.lotlab.org) 

正确接入后可看到固件编译日期及固件版本

<span id="如何确认PCB支持线刷">如何确认PCB支持线刷</span>
------------------
所谓`线刷`，即通过板载调试器进行蓝牙固件的刷写。

1. 从购买时间上判断，2020年4月之前购买的PCB都不支持，2020年6月后购买大部分支持

2. 从PCB颜色判断，PCB为黑色或白色的均支持，而绿色PCB只有极少数支持

3. 直接实验：通过CMSIS刷机工具或Lotkb固件烧录工具直接刷写固件，能正常刷入就支持

<span id="怎样切换不同SDK版本的固件">切换不同SDK版本的固件</span>
------------------
当前我们存在基于nRF SDK15.3的固件 与 基于nRF SDK17.1的固件。

1. 基于nRF SDK17.1与基于nRF SDK15.3的核心固件不能混刷
2. 如果仅刷写蓝牙核心固件，请严格对应SDK版本
3. 不同SDK版本之间切换，只能通过刷写蓝牙完整固件来完成
4. 不小心混刷核心固件后，可通过刷写蓝牙完整固件修复
5. 新版键盘出厂自带的为SDK17.1的固件，不建议回退到SDK15.3
6. 新版键盘请至产品页面下载SDK17.1的固件

<span id="蓝牙主控的区别">蓝牙主控的区别</span>
----------------

我们当前主要采用了nRF52811与nRF52832两种型号的蓝牙主控

两者的主要区别：

-  基本功能上没有区别。
-  nRF52832支持DFU升级，nRF52811不支持DFU升级
-  nRF52832拥有更高的性能，资源更丰富，有更好的后续扩展性
-  nRF52811芯片发布时间晚一点，支持更多蓝牙5.2特性

<span id="固件名称命令规则">固件名称命令规则</span>
----------------

如：Omega50-b-nrf52_kbd_sign-20210817-e35fd41.hex 

依次为：型号-子型号-固件类型-编译日期-固件版本.文件类型 

       
!!! tip "上面文件命名代表："

    型号：Omega50，子型号：B版本，固件类型：nrf_kbd_sign

    编译日期：20210817，固件版本：e35fd41，文件类型：hex

!!! tip "其中固件类型说明：" 

    - nrf52_kbd_sign ：已签名蓝牙核心固件;
    - nrf52_all : 蓝牙完整固件；
    - nrf52_dfu ：蓝牙DFU升级包；
    - ch554 ：USB固件